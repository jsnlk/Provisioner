<flat-profile>
	<!-- Reset Never -->
	<Resync_Periodic>{{ resync_periodic }}</Resync_Periodic>
	<Resync_On_Reset>Yes</Resync_On_Reset>
	<Profile_Rule>{{ provisioning_path }}spa$MA.xml</Profile_Rule>
	
	<!-- Phone Information -->
	<Text_Logo group="Phone/General">{{ text_logo }}</Text_Logo>
	<Logo_Type group="User/Screen">{{ logo_type }}</Logo_Type>
    <Background_Picture_Type group="User/Screen">{{ background_picture_type }}</Background_Picture_Type>
	<Select_Logo ua="na">{{ logo_type }}</Select_Logo>
	<Select_Background_Picture ua="ro">{{ background_type }}</Select_Background_Picture>
	<BMP_Picture_Download_URL ua="ro">{{ logo_url }}</BMP_Picture_Download_URL>
	<Station_Name group="Phone/General">{{ station_name }}</Station_Name>
	<Voice_Mail_Number group="Phone/General">{{ voicemail_number }}</Voice_Mail_Number>

	<!-- Line Registration Information -->
	{% set x = 1 %}
	{% for line in lines %}
	<Display_Name_{{ x }}_ group="SIP/SIP_Parameters" ua="na">{{ line.display_name }}</Display_Name_{{ x }}_>
	<!-- If BLF then set this to the BLF -->
	<Short_Name_{{ x }}_ group="Phone/Line_Key_{{ x }}" ua="na">{{ line.username }}</Short_Name_{{ x }}_> 
	<User_ID_{{ x }}_ ua="na">{{ line.auth_name }}</User_ID_{{ x }}_>
	<Password_{{ x }}_ ua="na">{{ line.auth_password }}</Password_{{ x }}_>
	<!-- Below set to disabled for BLF -->
	<Extension_{{ x }}_ group="Phone/Line_Key_{{ x }}">{{ line.blf_ext_type }}</Extension_{{ x }}_>
	<!-- If BLF set to shared -->
	<Share_Call_Appearance_{{ x }}_ group="Phone/Line_Key_{{ x }}">{{ line.share_call_appearance|default('private') }}</Share_Call_Appearance_{{ x }}_>
	<!-- this changes how the button works. If it's set when the phone isn't on blf then the button turns orange. so we probably need to remove this normally.-->
	<Extended_Function_{{ x }}_ group="Phone/Line_Key_{{ x }}">{{ line.ext_function }}</Extended_Function_{{ x }}_>
	<Dial_Plan_{{ x }}_ ua="na">{{ line.dialplan }}</Dial_Plan_{{ x }}_>
	<SIP_Port_{{ x }}_ group="Ext_{{ x }}/SIP_Settings">{{ line.sip_server.port }}</SIP_Port_{{ x }}_>
	<Register_Expires_{{ x }}_ group="Ext_{{ x }}/Proxy_and_Registration">{{ line.expire|default('3600') }}</Register_Expires_{{ x }}_>
	<Ans_Call_Without_Reg_{{ x }}_ ua="na">{{ line.answer_call_without_reg|default('No') }}</Ans_Call_Without_Reg_{{ x }}_>
	
	<!-- Codec Information -->
	<Preferred_Codec_{{ x }}_ group="Ext_{{ x }}/Audio_Configuration">{{ line.prefered_codec }}</Preferred_Codec_{{ x }}_>
	<Use_Pref_Codec_Only_{{ x }}_ group="Ext_{{ x }}/Audio_Configuration">No</Use_Pref_Codec_Only_{{ x }}_>
	<Second_Preferred_Codec_{{ x }}_ group="Ext_{{ x }}/Audio_Configuration">{{ line.second_codec }}</Second_Preferred_Codec_{{ x }}_>
	<Third_Preferred_Codec_{{ x }}_ group="Ext_{{ x }}/Audio_Configuration">{{ line.third_codec }}</Third_Preferred_Codec_{{ x }}_>
	
	<!-- Proxy Information -->
	<Proxy_{{ x }}_ group="Ext_{{ x }}/Proxy_and_Registration">{{ line.sip_server.host }}</Proxy_{{ x }}_>
	<Use_Outbound_Proxy_{{ x }}_ ua="na">{{ line.outbound_proxy.enable|default('No') }}</Use_Outbound_Proxy_{{ x }}_>
	<Outbound_Proxy_{{ x }}_ ua="na">{{ line.outbound_proxy.host }}</Outbound_Proxy_{{ x }}_>
	<Proxy_Fallback_Intvl_{{ x }}_ ua="ro">{{ line.outbound_proxy.fallback_interval|default('3600') }}</Proxy_Fallback_Intvl_{{ x }}_>
	<Proxy_Redundancy_Method_{{ x }}_ ua="ro">{{line.outbound_proxy.redundancy_method|default('Normal') }}</Proxy_Redundancy_Method_{{ x }}_>
	
	<!-- DNS SRV Information -->
	<Use_DNS_SRV_{{ x }}_ ua="rw">{{ line.dns_srv.enable|default('No') }}</Use_DNS_SRV_{{ x }}_>
	<DNS_SRV_Auto_Prefix_{{ x }}_ group="Ext_{{ x }}/Proxy_and_Registration">{{ line.dns_srv.prefix|default('Yes') }}</DNS_SRV_Auto_Prefix_{{ x }}_>

	<!-- NAT -->
	<NAT_Mapping_Enable_{{ x }}_ group="Ext_{{ x }}/NAT_Settings">{{ line.nat.mapping_enable|default('Yes') }}</NAT_Mapping_Enable_{{ x }}_>
	<NAT_Keep_Alive_Enable_{{ x }}_ group="Ext_{{ x }}/NAT_Settings">{{ line.nat.keep_alive_enabled|default('Yes') }}</NAT_Keep_Alive_Enable_{{ x }}_>
	{% set x = x + 1 %}
	{% endfor %}

	<!-- Registration Settings -->
	<Reg_Min_Expires group="SIP/SIP_Timer_Values__sec_">1</Reg_Min_Expires>
	<Reg_Max_Expires group="SIP/SIP_Timer_Values__sec_">600</Reg_Max_Expires>
	<Reg_Retry_Intvl group="SIP/SIP_Timer_Values__sec_">10</Reg_Retry_Intvl>
	<Reg_Retry_Long_Intvl group="SIP/SIP_Timer_Values__sec_">20</Reg_Retry_Long_Intvl>

	<!-- RTP Settings -->
	<RTP_Packet_Size group="SIP/RTP_Parameters">0.020</RTP_Packet_Size>

	<!-- Codec Names -->
	<G711u_Codec_Name group="SIP/SDP_Payload_Types">PCMU</G711u_Codec_Name>
	<G711a_Codec_Name group="SIP/SDP_Payload_Types">PCMA</G711a_Codec_Name>
	<G726r16_Codec_Name group="SIP/SDP_Payload_Types">G726-16</G726r16_Codec_Name>
	<G726r24_Codec_Name group="SIP/SDP_Payload_Types">G726-24</G726r24_Codec_Name>
	<G726r32_Codec_Name group="SIP/SDP_Payload_Types">G726-32</G726r32_Codec_Name>
	<G726r40_Codec_Name group="SIP/SDP_Payload_Types">G726-40</G726r40_Codec_Name>
	<G729a_Codec_Name group="SIP/SDP_Payload_Types">G729</G729a_Codec_Name>
	<G729b_Codec_Name group="SIP/SDP_Payload_Types">G729</G729b_Codec_Name>
	<G722_Codec_Name group="SIP/SDP_Payload_Types">G722</G722_Codec_Name>
	
	 <!-- Firmware -->
	 <Upgrade_Enable ua="ro">{{ upgrade.enable }}</Upgrade_Enable>
	 <Upgrade_Rule ua="ro">{{ upgrade.rule }}</Upgrade_Rule>

	<!-- Admin -->
	 <Enable_Web_Server ua="na">{{ webserver.enable }}</Enable_Web_Server>
	 <Web_Server_Port ua="na">{{ webserver.port }}</Web_Server_Port>
	 <Enable_Web_Admin_Access ua="na">{{ webserver.enable_admin }}</Enable_Web_Admin_Access>
	 <Admin_Passwd ua="na">{{ webserver.admin_password }}</Admin_Passwd>
	 <User_Password ua="na">{{ webserver.user_password }}</User_Password>
	 <Enable_CDP group="System/VLAN_Settings">{{ enable_cdp|default('No') }}</Enable_CDP>

	 <!-- Timezone Stuff -->
	 <Primary_NTP_Server ua="na">{{ ntp_server }}</Primary_NTP_Server>
	 <Time_Zone  ua="na">{{ timezone }}</Time_Zone>
	 <Daylight_Saving_Time_Rule ua="na">start=3/8/7/02:0:0;end=11/1/7/02:0:0;save=1</Daylight_Saving_Time_Rule>
	 <Daylight_Saving_Time_Enable group="Regional/Miscellaneous">Yes</Daylight_Saving_Time_Enable>
	 <Date_Format>{{ date_format }}</Date_Format>
	 <Time_Format>{{ time_format }}</Time_Format>

	 <!-- KeyCodes -->
	 <Call_Return_Code ua="na"> </Call_Return_Code>
	 <Blind_Transfer_Code > </Blind_Transfer_Code>
	 <Call_Back_Act_Code> </Call_Back_Act_Code>
	 <Call_Back_Deact_Code> </Call_Back_Deact_Code>
	 <Cfwd_All_Act_Code> </Cfwd_All_Act_Code>
	 <Cfwd_All_Deact_Code> </Cfwd_All_Deact_Code>
	 <Cfwd_Busy_Act_Code> </Cfwd_Busy_Act_Code>
	 <Cfwd_Busy_Deact_Code> </Cfwd_Busy_Deact_Code>
	 <Cfwd_No_Ans_Act_Code> </Cfwd_No_Ans_Act_Code>
	 <Cfwd_No_Ans_Deact_Code> </Cfwd_No_Ans_Deact_Code>
	 <CW_Act_Code> </CW_Act_Code>
	 <CW_Deact_Code> </CW_Deact_Code>
	 <CW_Per_Call_Act_Code> </CW_Per_Call_Act_Code>
	 <CW_Per_Call_Deact_Code> </CW_Per_Call_Deact_Code>
	 <Block_CID_Act_Code> </Block_CID_Act_Code>
	 <Block_CID_Deact_Code> </Block_CID_Deact_Code>
	 <Block_CID_Per_Call_Act_Code> </Block_CID_Per_Call_Act_Code>
	 <Block_CID_Per_Call_Deact_Code> </Block_CID_Per_Call_Deact_Code>
	 <Block_ANC_Act_Code> </Block_ANC_Act_Code>
	 <Block_ANC_Deact_Code> </Block_ANC_Deact_Code>
	 <DND_Act_Code> </DND_Act_Code>
	 <DND_Deact_Code> </DND_Deact_Code>
	 <Secure_All_Call_Act_Code> </Secure_All_Call_Act_Code>
	 <Secure_No_Call_Act_Code> </Secure_No_Call_Act_Code>
	 <Secure_One_Call_Act_Code> </Secure_One_Call_Act_Code>
	 <Secure_One_Call_Deact_Code> </Secure_One_Call_Deact_Code>
	 <Paging_Code ua="na">{{ paging_code }}</Paging_Code>
	 <Call_Park_Code> </Call_Park_Code>
	 <Call_Pickup_Code> </Call_Pickup_Code>
	 <Call_UnPark_Code> </Call_UnPark_Code>
	 <Group_Call_Pickup_Code> </Group_Call_Pickup_Code>
	 <Media_Loopback_Code> </Media_Loopback_Code>
	 <Referral_Services_Codes> </Referral_Services_Codes>

	<!-- Debug Information -->
	<Syslog_Server group="System/Optional_Network_Configuration">{{ syslog_server }}</Syslog_Server>
	<Debug_Level group="System/Optional_Network_Configuration">3</Debug_Level>
	<Debug_Server group="System/Optional_Network_Configuration">{{ syslog_server }}</Debug_Server>

	<!-- Speed Dials -->
	<Speed_Dial_2 ua="rw">{{ speed_dial.2 }}</Speed_Dial_2>
	<Speed_Dial_3 ua="rw">{{ speed_dial.3 }}</Speed_Dial_3>
	<Speed_Dial_4 ua="rw">{{ speed_dial.4 }}</Speed_Dial_4>
	<Speed_Dial_5 ua="rw">{{ speed_dial.5 }}</Speed_Dial_5>
	<Speed_Dial_6 ua="rw">{{ speed_dial.6 }}</Speed_Dial_6>
	<Speed_Dial_7 ua="rw">{{ speed_dial.7 }}</Speed_Dial_7>
	<Speed_Dial_8 ua="rw">{{ speed_dial.8 }}</Speed_Dial_8>
	<Speed_Dial_9 ua="rw">{{ speed_dial.9 }}</Speed_Dial_9>
	
	<Subscribe_Expires group="Attendant_Console/General">1800</Subscribe_Expires>
	<Subscribe_Retry_Interval group="Attendant_Console/General">30</Subscribe_Retry_Interval>
	<Subscribe_Delay group="Attendant_Console/General">1</Subscribe_Delay>
	<Server_Type group="Attendant_Console/General">{{ ac.server_type }}</Server_Type>
	<Programmable_Softkey_Enable group="Phone/Programmable_Softkeys">Yes</Programmable_Softkey_Enable>
	<Test_Mode_Enable group="Attendant_Console/General">No</Test_Mode_Enable>
	<Attendant_Console_Call_Pickup_Code group="Attendant_Console/General">{{ ac.call_pickup }}</Attendant_Console_Call_Pickup_Code>
	<BLF_List_URI group="Attendant_Console/General"/>
	<Application_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<Serv_Subscribe_Failed_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<Serv_Subscribing_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<SNRM_Day_Mode_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<SNRM_Night_Mode_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<Parking_Lot_Idle_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<Parking_Lot_Busy_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<BLF_Idle_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<BLF_Ringing_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<BLF_Busy_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<BLF_Held_LED group="Attendant_Console/Attendant_Key_LED_Pattern"/>
	<Unit_1_Enable group="Attendant_Console/General">Yes</Unit_1_Enable>
	{% set x = 1 %}
	{% for unit in unit1 %}
	<Unit_1_Key_{{ x }} group="Attendant_Console/Unit_1">{{ unit.data }}</Unit_1_Key_{{ x }}>
	{% set x = x + 1 %}
	{% endfor %}
	<Unit_2_Enable group="Attendant_Console/General">Yes</Unit_2_Enable>
	{% set x = 1 %}
	{% for unit in unit2 %}
	<Unit_2_Key_{{ x }} group="Attendant_Console/Unit_2">{{ unit.data }}</Unit_2_Key_{{ x }}>
	{% set x = x + 1 %}
	{% endfor %}

	<!-- Ring tones and Cadences -->
	<Ring1 group="Phone/Ring_Tone">{{ ring1|default('n=Classic-1;w=3;c=1') }}</Ring1>
	<Ring2 group="Phone/Ring_Tone">{[ ring2|default('n=Classic-2;w=3;c=2') }}</Ring2>
	<Ring3 group="Phone/Ring_Tone">{{ ring3|default('n=Classic-3;w=3;c=3') }}</Ring3>
	<Ring4 group="Phone/Ring_Tone">{{ ring4|default('n=Classic-4;w=3;c=4') }}</Ring4>
	<Ring5 group="Phone/Ring_Tone">{{ ring5|default('n=Simple-1;w=2;c=1') }}</Ring5>
	<Ring6 group="Phone/Ring_Tone">{{ ring6|default('n=Simple-2;w=2;c=2') }}</Ring6>
	<Ring7 group="Phone/Ring_Tone">{{ ring7|default('n=Simple-3;w=2;c=3') }}</Ring7>
	<Ring8 group="Phone/Ring_Tone">{{ ring8|default('n=Simple-4;w=2;c=4') }}</Ring8>
	<Ring9 group="Phone/Ring_Tone">{{ ring9|default('n=Simple-5;w=2;c=5') }}</Ring9>
	<Ring10 group="Phone/Ring_Tone">{{ ring10|default('n=Office;w=4;c=1') }}</Ring10>
	
	<!-- IP information -->
	<Connection_Type group="System/Internet_Connection_Type_">{{ connection_type }}</Connection_Type>
	<Static_IP group="System/_Static_IP_Settings">{{ static_ip }}</Static_IP>
	<NetMask group="System/_Static_IP_Settings">{{ netmask }}</NetMask>
	<Gateway group="System/_Static_IP_Settings">{{ gateway }}</Gateway>
	<Primary_DNS group="System/Optional_Network_Configuration">{{ primary_dns }}</Primary_DNS>

	<XML_Directory_Service_Name group="Phone/XML_Service">{{ xml_directory_service.name }}</XML_Directory_Service_Name>
	<XML_Directory_Service_URL group="Phone/XML_Service">{{ xml_directory_service.url }}</XML_Directory_Service_URL>
	<XML_Application_Service_Name group="Phone/XML_Service"/>
	<XML_Application_Service_URL group="Phone/XML_Service"/>
	<XML_User_Name group="Phone/XML_Service"/>
	<XML_Password group="Phone/XML_Service"/>
	
	<!-- LDAP Settings for Directory -->
	<LDAP_Dir_Enable group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.enable|default('No') }}</LDAP_Dir_Enable>
	<LDAP_Corp_Dir_Name group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.name }}</LDAP_Corp_Dir_Name>
	<LDAP_Server group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.server }}</LDAP_Server>
	<LDAP_Auth_Method group="Phone/LDAP_Corporate_Directory_Search">Simple</LDAP_Auth_Method>
	<LDAP_Client_DN group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.account }}</LDAP_Client_DN>
	<LDAP_Username group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.account }}</LDAP_Username>
	<LDAP_Password group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.account }}</LDAP_Password>
	<LDAP_Search_Base group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.base }}</LDAP_Search_Base>
	<LDAP_Last_Name_Filter group="Phone/LDAP_Corporate_Directory_Search">cn:(cn=*$VALUE*)</LDAP_Last_Name_Filter>
	<LDAP_First_Name_Filter group="Phone/LDAP_Corporate_Directory_Search">cn:(cn=*$VALUE*)</LDAP_First_Name_Filter>
	<LDAP_Search_Item_3 group="Phone/LDAP_Corporate_Directory_Search"/>
	<LDAP_Item_3_Filter group="Phone/LDAP_Corporate_Directory_Search"/>
	<LDAP_Search_Item_4 group="Phone/LDAP_Corporate_Directory_Search"/>
	<LDAP_item_4_Filter group="Phone/LDAP_Corporate_Directory_Search"/>
	<LDAP_Display_Attrs group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.attrs|default('a=cn;a=sn;a=telephoneNumber,n=Phone,t=p;') }}</LDAP_Display_Attrs>
	<LDAP_Number_Mapping group="Phone/LDAP_Corporate_Directory_Search">{{ ldap.mapping }}</LDAP_Number_Mapping>

	<!-- Regional configuration. Dialtone, MWI tone -->
	<Dial_Tone group="Regional/Call_Progress_Tones">{{ dial_tone|default('350@-19,440@-19;10(*/0/1+2)') }}</Dial_Tone> 
	<MWI_Dial_Tone group="Regional/Call_Progress_Tones">{{ mwi_tone|default('350@-19,440@-19;2(.1/.1/1+2);10(*/0/1+2)') }}</MWI_Dial_Tone>
       <Back_Light_Timer group="User/LCD">{{ backlite_timer }}</Back_Light_Timer> 

</flat-profile>